<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Extra parameters • DataFakeR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Extra parameters">
<meta property="og:description" content="DataFakeR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">DataFakeR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-thumbs-o-up"></span>
     
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/main.html">Welcome</a>
    </li>
    <li>
      <a href="../articles/datafaker_workflow.html">DataFakeR workflow</a>
    </li>
    <li>
      <a href="../articles/schema_structure.html">YAML schema structure</a>
    </li>
    <li>
      <a href="../articles/structure_from_db.html">Sourcing structure from database</a>
    </li>
    <li>
      <a href="../articles/simulation_options.html">Simulation Options</a>
    </li>
    <li>
      <a href="../articles/simulation_methods.html">Simulation Methods</a>
    </li>
    <li>
      <a href="../articles/extra_parameters.html">Extra parameters</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    Functions
  </a>
</li>
<li>
  <a href="../news/index.html">
    <span class="fa fa-newspaper-o"></span>
     
    News
  </a>
</li>
<li>
  <a href="https://github.com/openpharma/DataFakeR/issues">
    <span class="fa fa-ambulance"></span>
     
    Issues
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="extra_parameters_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Extra parameters</h1>
                        <h4 class="author">Krystian Igras</h4>
            
            <h4 class="date">2021-09-20</h4>
      
      
      <div class="hidden name"><code>extra_parameters.Rmd</code></div>

    </div>

    
    
<p>Most of the functionality offered by DataFakeR were described in the remaining vignettes. Goal of this section is to present additional options offered by DataFakeR that can make your data simulating workflow much easier.</p>
<div id="grouped-simulation" class="section level3">
<h3 class="hasAnchor">
<a href="#grouped-simulation" class="anchor"></a>Grouped simulation</h3>
<p>It is quite common that values of the column are strongly related to the groups defined by the other column values.</p>
<p>Some of the examples may be the age of death that may differ between males and females.</p>
<p>In order to allow simulating values based on groups designed by the other columns, <code>group_by</code> parameter was introduced.</p>
<p>Let’s see the below schema structure:</p>
<pre><code># schema-patient.yml
public:
  tables:
    patient:
      columns:
        treatment_id:
          type: varchar
          formula: !expr paste0(patient_id, line_number)
        patient_id:
          type: char(8)
        line_number: 
          type: smallint
        gender:
          type: char(1)
          values: [F, M]
        biomarker:
          type: numeric
          range: [0, 1]</code></pre>
<p>Let’s simulate the data using the below definition:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_source.html">schema_source</a></span><span class="op">(</span><span class="st">"schema-patient.yml"</span><span class="op">)</span>
<span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_simulate</a></span><span class="op">(</span><span class="va">sch</span><span class="op">)</span>
<span class="fu"><a href="../reference/schema_methods.html">schema_get_table</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"patient"</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 10 x 5</span>
<span class="co">#&gt;    treatment_id   patient_id line_number gender biomarker</span>
<span class="co">#&gt;    &lt;chr&gt;          &lt;chr&gt;            &lt;int&gt; &lt;chr&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt;  1 OoVtwCbu-16802 OoVtwCbu        -16802 M          0.600</span>
<span class="co">#&gt;  2 cXxXjdFu11013  cXxXjdFu         11013 M          0.333</span>
<span class="co">#&gt;  3 MCRxukhz-5398  MCRxukhz         -5398 F          0.489</span>
<span class="co">#&gt;  4 ikcePHyu18886  ikcePHyu         18886 M          0.954</span>
<span class="co">#&gt;  5 jpBYnLQM-26027 jpBYnLQM        -26027 M          0.483</span>
<span class="co">#&gt;  6 HVVTHHMY-4267  HVVTHHMY         -4267 F          0.890</span>
<span class="co">#&gt;  7 NsCWpGdK31781  NsCWpGdK         31781 F          0.914</span>
<span class="co">#&gt;  8 GnuTiETO25758  GnuTiETO         25758 M          0.609</span>
<span class="co">#&gt;  9 qXqqpWng25327  qXqqpWng         25327 F          0.411</span>
<span class="co">#&gt; 10 kAYLTfSF-21296 kAYLTfSF        -21296 F          0.147</span></code></pre></div>
<p>Now we’d like to extend the definition following the below rules:</p>
<ol style="list-style-type: decimal">
<li>For each <code>patient_id</code> we usually want to have more than one row (it allows us to analyze the patient in multiple treatment stages).</li>
<li>For each <code>patient_id</code>, <code>lineid</code> is the sequence starting from 1 to the number of patient rows.</li>
<li>
<code>gender</code> should be unique for each <code>patient_id</code> value.</li>
<li>
<code>biomarker</code> value should <code>mean = 0.5</code> for females and <code>mean = 0.6</code> for males.</li>
</ol>
<div id="rule-no-1" class="section level4">
<h4 class="hasAnchor">
<a href="#rule-no-1" class="anchor"></a>Rule no 1</h4>
<p>Let’s start with condition 1. We may simply achieve this by providing possible <code>patient_id</code> values with unique number less than target number of rows.</p>
<pre><code># schema-patient_2.yml
public:
  tables:
    patient:
      columns:
        treatment_id:
          type: varchar
          formula: !expr paste0(patient_id, line_number)
        patient_id:
          type: char(8)
          values: [PTNT01ID, PTNT02ID, PTNT03ID]
        line_number: 
          type: smallint
        gender:
          type: char(1)
          values: [F, M]
        biomarker:
          type: numeric
          range: [0, 1]</code></pre>
<p>Let’s simulate the data using the below definition:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_update_source</a></span><span class="op">(</span><span class="va">sch</span>, file <span class="op">=</span> <span class="st">"schema-patient_2.yml"</span><span class="op">)</span>
<span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_simulate</a></span><span class="op">(</span><span class="va">sch</span><span class="op">)</span>
<span class="fu"><a href="../reference/schema_methods.html">schema_get_table</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"patient"</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 10 x 5</span>
<span class="co">#&gt;    treatment_id   patient_id line_number gender biomarker</span>
<span class="co">#&gt;    &lt;chr&gt;          &lt;chr&gt;            &lt;int&gt; &lt;chr&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt;  1 PTNT02ID-8554  PTNT02ID         -8554 M         0.843 </span>
<span class="co">#&gt;  2 PTNT03ID31733  PTNT03ID         31733 M         0.231 </span>
<span class="co">#&gt;  3 PTNT01ID-22662 PTNT01ID        -22662 M         0.239 </span>
<span class="co">#&gt;  4 PTNT02ID-26801 PTNT02ID        -26801 M         0.0767</span>
<span class="co">#&gt;  5 PTNT02ID-23468 PTNT02ID        -23468 M         0.246 </span>
<span class="co">#&gt;  6 PTNT03ID12452  PTNT03ID         12452 F         0.732 </span>
<span class="co">#&gt;  7 PTNT02ID7815   PTNT02ID          7815 M         0.847 </span>
<span class="co">#&gt;  8 PTNT01ID25650  PTNT01ID         25650 M         0.498 </span>
<span class="co">#&gt;  9 PTNT03ID11337  PTNT03ID         11337 M         0.388 </span>
<span class="co">#&gt; 10 PTNT03ID15536  PTNT03ID         15536 F         0.246</span></code></pre></div>
</div>
<div id="rule-no-2" class="section level4">
<h4 class="hasAnchor">
<a href="#rule-no-2" class="anchor"></a>Rule no 2</h4>
<p>Now, we’d like to make sure <code>line_id</code> is a sequence <code>1:n</code>, where <code>n</code> is the number of rows for each patient.</p>
<p>If we define <code>line_number</code> formula as <code>!expr 1:dplyr::n()</code>, the resulting column would be a sequence <code>1:n</code> where <code>n</code> is the number of table rows. There is an obvious need to apply grouping by <code>patient_id</code>.</p>
<p>How can we achieve this in DataFakeR?</p>
<p>It is enough to add <code>group_by: patient_id</code> parameter to <code>line_number</code>.</p>
<p>Let’s see it in action:</p>
<pre><code># schema-patient_3.yml
public:
  tables:
    patient:
      columns:
        treatment_id:
          type: varchar
          formula: !expr paste0(patient_id, line_number)
        patient_id:
          type: char(8)
          values: [PTNT01ID, PTNT02ID, PTNT03ID]
        line_number: 
          type: smallint
          group_by: patient_id
          formula: !expr 1:dplyr::n()
        gender:
          type: char(1)
          values: [F, M]
        biomarker:
          type: numeric
          range: [0, 1]</code></pre>
<p>Looking at the dependency graph:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_update_source</a></span><span class="op">(</span><span class="va">sch</span>, file <span class="op">=</span> <span class="st">"schema-patient_3.yml"</span><span class="op">)</span>
<span class="fu"><a href="../reference/schema_methods.html">schema_plot_deps</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"patient"</span><span class="op">)</span></code></pre></div>
<p><img src="extra_parameters_files/figure-html/unnamed-chunk-3-1.png" width="1600" style="display: block; margin: auto;"></p>
<p>we can see, DataFakeR detected dependency between <code>patient_id</code> and <code>line_numer</code> column.</p>
<p><code>line_number</code> was also created according to our needs:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_simulate</a></span><span class="op">(</span><span class="va">sch</span><span class="op">)</span>
<span class="fu"><a href="../reference/schema_methods.html">schema_get_table</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"patient"</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 10 x 5</span>
<span class="co">#&gt;    treatment_id patient_id line_number gender biomarker</span>
<span class="co">#&gt;    &lt;chr&gt;        &lt;chr&gt;            &lt;int&gt; &lt;chr&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt;  1 PTNT03ID1    PTNT03ID             1 F         0.974 </span>
<span class="co">#&gt;  2 PTNT02ID1    PTNT02ID             1 F         0.760 </span>
<span class="co">#&gt;  3 PTNT02ID2    PTNT02ID             2 M         0.887 </span>
<span class="co">#&gt;  4 PTNT02ID3    PTNT02ID             3 M         0.222 </span>
<span class="co">#&gt;  5 PTNT01ID1    PTNT01ID             1 F         0.270 </span>
<span class="co">#&gt;  6 PTNT02ID4    PTNT02ID             4 M         0.607 </span>
<span class="co">#&gt;  7 PTNT02ID5    PTNT02ID             5 F         0.340 </span>
<span class="co">#&gt;  8 PTNT02ID6    PTNT02ID             6 M         0.757 </span>
<span class="co">#&gt;  9 PTNT01ID2    PTNT01ID             2 M         0.0748</span>
<span class="co">#&gt; 10 PTNT02ID7    PTNT02ID             7 M         0.891</span></code></pre></div>
</div>
<div id="rule-no-3" class="section level4">
<h4 class="hasAnchor">
<a href="#rule-no-3" class="anchor"></a>Rule no 3</h4>
<p>Now let’s assure gender is unique for each patient.</p>
<p>To achieve this, we’ll have to group by <code>patient_id</code> and sample one value from <code>c("F", "M)</code> and repeat this with desired number of rows.</p>
<p>We may again use the formula, but for the sake of the example we’ll define custom restricted method.</p>
<p>The method will be executed whenever <code>singular: true</code> parameter is provided to the column.</p>
<pre><code># schema-patient_4.yml
public:
  tables:
    patient:
      columns:
        treatment_id:
          type: varchar
          formula: !expr paste0(patient_id, line_number)
        patient_id:
          type: char(8)
          values: [PTNT01ID, PTNT02ID, PTNT03ID]
        line_number: 
          type: smallint
          group_by: patient_id
          formula: !expr 1:dplyr::n()
        gender:
          type: char(1)
          values: [F, M]
          singular: true
          group_by: patient_id
        biomarker:
          type: numeric
          range: [0, 1]</code></pre>
<p>The method definition:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">singular_vals</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">values</span>, <span class="va">singular</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>

  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html">missing</a></span><span class="op">(</span><span class="va">singular</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/Logic.html">isTRUE</a></span><span class="op">(</span><span class="va">singular</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">values</span>, <span class="fl">1</span><span class="op">)</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">val</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>

  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>and add it to schema options:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_opts</span> <span class="op">=</span> <span class="fu"><a href="../reference/faker_configuration.html">set_faker_opts</a></span><span class="op">(</span>
  opt_simul_restricted_character <span class="op">=</span> <span class="fu"><a href="../reference/restricted_simulation.html">opt_simul_restricted_character</a></span><span class="op">(</span>
    singular <span class="op">=</span> <span class="va">singular_vals</span>
  <span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Now we can start simulation:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_update_source</a></span><span class="op">(</span><span class="va">sch</span>, file <span class="op">=</span> <span class="st">"schema-patient_4.yml"</span>, <span class="va">my_opts</span><span class="op">)</span>
<span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_simulate</a></span><span class="op">(</span><span class="va">sch</span><span class="op">)</span>
<span class="fu"><a href="../reference/schema_methods.html">schema_get_table</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"patient"</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 10 x 5</span>
<span class="co">#&gt;    treatment_id patient_id line_number gender biomarker</span>
<span class="co">#&gt;    &lt;chr&gt;        &lt;chr&gt;            &lt;int&gt; &lt;chr&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt;  1 PTNT01ID1    PTNT01ID             1 M        0.716  </span>
<span class="co">#&gt;  2 PTNT02ID1    PTNT02ID             1 M        0.595  </span>
<span class="co">#&gt;  3 PTNT02ID2    PTNT02ID             2 M        0.0432 </span>
<span class="co">#&gt;  4 PTNT01ID2    PTNT01ID             2 M        0.449  </span>
<span class="co">#&gt;  5 PTNT01ID3    PTNT01ID             3 M        0.639  </span>
<span class="co">#&gt;  6 PTNT02ID3    PTNT02ID             3 M        0.801  </span>
<span class="co">#&gt;  7 PTNT02ID4    PTNT02ID             4 M        0.542  </span>
<span class="co">#&gt;  8 PTNT02ID5    PTNT02ID             5 M        0.882  </span>
<span class="co">#&gt;  9 PTNT03ID1    PTNT03ID             1 M        0.00679</span>
<span class="co">#&gt; 10 PTNT01ID4    PTNT01ID             4 M        0.447</span></code></pre></div>
<p>Voila!</p>
</div>
<div id="rule-no-4" class="section level4">
<h4 class="hasAnchor">
<a href="#rule-no-4" class="anchor"></a>Rule no 4</h4>
<p>We’d like to sample from normal distribution with a specific mean dependent on the gender value.</p>
<p>Again we have a few options here. The simplest one would be to group <code>biomarker</code> by <code>gender</code> and use:</p>
<p><code>formula: ifelse(gender == "F", rnorm(dplyr::n(), 0.5, 0.01), rnorm(dplyr::n(), 0.6, 0.01))</code></p>
<p>but we’ll do it using a special method instead.</p>
<p>The main issue we might have is how to access the group value from within the method. We shouldn’t be worried. DataFakeR automatically passes the value as a <code>group_val</code> parameter.</p>
<p>So let’s try it out.</p>
<p>Let’s define spec method named <code>dep_sampl</code>:</p>
<pre><code># schema-patient_5.yml
public:
  tables:
    patient:
      columns:
        treatment_id:
          type: varchar
          formula: !expr paste0(patient_id, line_number)
        patient_id:
          type: char(8)
          values: [PTNT01ID, PTNT02ID, PTNT03ID]
        line_number:
          type: smallint
          group_by: patient_id
          formula: !expr 1:dplyr::n()
        gender:
          type: char(1)
          values: [F, M]
          singular: true
          group_by: patient_id
        biomarker:
          type: numeric
          range: [0, 1]
          spec: dep_sampl
          group_by: gender</code></pre>
<p>Inside function definition let’s add print line to see current <code>group_key</code> value:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dep_sampl</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">group_val</span>, <span class="va">range</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">group_val</span><span class="op">)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">group_val</span> <span class="op">==</span> <span class="st">"M"</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmax</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmin</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0.6</span>, <span class="fl">0.01</span><span class="op">)</span>, <span class="va">range</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="va">range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmax</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmin</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0.5</span>, <span class="fl">0.01</span><span class="op">)</span>, <span class="va">range</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="va">range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span>

<span class="va">my_opts</span> <span class="op">=</span> <span class="fu"><a href="../reference/faker_configuration.html">set_faker_opts</a></span><span class="op">(</span>
  opt_simul_spec_numeric <span class="op">=</span> <span class="fu"><a href="../reference/special_simulation.html">opt_simul_spec_numeric</a></span><span class="op">(</span>
    dep_sampl <span class="op">=</span> <span class="va">dep_sampl</span>
  <span class="op">)</span>,
  <span class="co"># don't forget option from previous case</span>
  opt_simul_restricted_character <span class="op">=</span> <span class="fu"><a href="../reference/restricted_simulation.html">opt_simul_restricted_character</a></span><span class="op">(</span>
    singular <span class="op">=</span> <span class="va">singular_vals</span>
  <span class="op">)</span>
<span class="op">)</span>

<span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_update_source</a></span><span class="op">(</span><span class="va">sch</span>, file <span class="op">=</span> <span class="st">"schema-patient_5.yml"</span>, <span class="va">my_opts</span><span class="op">)</span>
<span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_simulate</a></span><span class="op">(</span><span class="va">sch</span><span class="op">)</span>
<span class="co">#&gt; [1] "M"</span>
<span class="fu"><a href="../reference/schema_methods.html">schema_get_table</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"patient"</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 10 x 5</span>
<span class="co">#&gt;    treatment_id patient_id line_number gender biomarker</span>
<span class="co">#&gt;    &lt;chr&gt;        &lt;chr&gt;            &lt;int&gt; &lt;chr&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt;  1 PTNT02ID1    PTNT02ID             1 M          0.602</span>
<span class="co">#&gt;  2 PTNT01ID1    PTNT01ID             1 M          0.587</span>
<span class="co">#&gt;  3 PTNT03ID1    PTNT03ID             1 M          0.589</span>
<span class="co">#&gt;  4 PTNT02ID2    PTNT02ID             2 M          0.599</span>
<span class="co">#&gt;  5 PTNT03ID2    PTNT03ID             2 M          0.603</span>
<span class="co">#&gt;  6 PTNT03ID3    PTNT03ID             3 M          0.600</span>
<span class="co">#&gt;  7 PTNT01ID2    PTNT01ID             2 M          0.600</span>
<span class="co">#&gt;  8 PTNT03ID4    PTNT03ID             4 M          0.599</span>
<span class="co">#&gt;  9 PTNT03ID5    PTNT03ID             5 M          0.594</span>
<span class="co">#&gt; 10 PTNT02ID3    PTNT02ID             3 M          0.608</span></code></pre></div>
<p>This way we achieved assumed goal.</p>
</div>
</div>
<div id="ratio-of-na-values" class="section level3">
<h3 class="hasAnchor">
<a href="#ratio-of-na-values" class="anchor"></a>Ratio of NA values</h3>
<p>Another extra parameter offered by DataFakeR is <code>na_ratio</code>. Na ratio allows to precise the ratio of how many NA values should the column have.</p>
<p>For each simulation method the final sample is modified by <a href="../reference/sample_modifiers.html">na_rand</a> function, that replaces desired ratio of values with <code>NA</code>s. Default <code>na_ratio</code> value is <code>0.05</code> but can be easily overwritten by <code>opt_default_</code> configuration, or passed directly in column definition.</p>
<p><strong>Note</strong> Whenever column have defined <code>not_null: true</code>, <code>na_rand</code> doesn’t attach <code>NA</code> values to the sample.</p>
</div>
<div id="ratio-of-column-values" class="section level3">
<h3 class="hasAnchor">
<a href="#ratio-of-column-values" class="anchor"></a>Ratio of column values</h3>
<p>The last extra parameter offered by DataFakeR is <code>levels_ratio</code>. Levels ratio allows to precise how many unique values should the column have.</p>
<p>For each simulation method (before the sample is modified by <code>na_rand</code>) the sample is modified by <a href="../reference/sample_modifiers.html">levels_rand</a> function, that takes desired number of sample levels and resamples it using only provided levels. Default <code>levels_ratio</code> is <code>1</code> but can be easily overwritten by <code>opt_default_</code> configuration, or passed directly in column definition.</p>
<p><strong>Note</strong> Whenever column have defined <code>unique: true</code> or <code>levels_ratio: 1</code>, <code>levels_rand</code> doesn’t modify the sample.</p>
</div>
<div id="remaining-parameters" class="section level3">
<h3 class="hasAnchor">
<a href="#remaining-parameters" class="anchor"></a>Remaining parameters</h3>
<p>There are a few parameters that can be configured to each column and be handled by <a href="simulation_methods.html">all the simulation methods</a>.</p>
<p>Such parameters are:</p>
<ul>
<li>
<code>values</code> - The parameter keeps possible values for the simulated column,</li>
<li>
<code>range</code> - Two-length parameter storing minimum and maximum value for simulated column (numeric, integer and date only),</li>
<li>
<code>precision</code> - Precision of numeric column values,</li>
<li>
<code>scale</code> - Scale of numeric column values,</li>
<li>
<code>min_date</code>, <code>max_date</code> - minimal and maximal values for simulating date columns (overwritten by <code>range</code> when specified),</li>
<li>
<code>format</code> - Date format of <code>min_date</code>, <code>max_date</code> and <code>range</code> in case of date columns (%Y-%m-%d by default),</li>
<li>
<code>nchar</code> - Maximum number of characters for simulating character column (10 by default).</li>
</ul>
<p>Whenever any of the above parameters is defined as a parameter of column-type simulation method, such value can be used to get more accurate result respecting the configuration.</p>
<p>For example default character simulation method (<a href="../reference/simulation_methods_character.html">simul_default_character</a>) takes an advantage of <code>nchar</code> parameter, but special method for simulating names don’t (<a href="../reference/simulation_methods_character.html">simul_spec_character_name</a>).</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Krystian Igras.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
