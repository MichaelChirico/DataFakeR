<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulation methods • DataFakeR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Simulation methods">
<meta property="og:description" content="DataFakeR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">DataFakeR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-thumbs-o-up"></span>
     
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/main.html">Welcome</a>
    </li>
    <li>
      <a href="../articles/datafaker_workflow.html">DataFakeR workflow</a>
    </li>
    <li>
      <a href="../articles/schema_structure.html">YAML schema structure</a>
    </li>
    <li>
      <a href="../articles/structure_from_db.html">Sourcing structure from database</a>
    </li>
    <li>
      <a href="../articles/simulation_options.html">Simulation Options</a>
    </li>
    <li>
      <a href="../articles/simulation_methods.html">Simulation Methods</a>
    </li>
    <li>
      <a href="../articles/extra_parameters.html">Extra parameters</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    Functions
  </a>
</li>
<li>
  <a href="../news/index.html">
    <span class="fa fa-newspaper-o"></span>
     
    News
  </a>
</li>
<li>
  <a href="https://github.com/openpharma/DataFakeR/issues">
    <span class="fa fa-ambulance"></span>
     
    Issues
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="simulation_methods_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Simulation methods</h1>
                        <h4 class="author">Krystian Igras</h4>
            
            <h4 class="date">2021-09-21</h4>
      
      
      <div class="hidden name"><code>simulation_methods.Rmd</code></div>

    </div>

    
    
<p>DataFakeR offers various methods for defining how exactly each column should be simulated.</p>
<p>We can highlight the below four simulation method types:</p>
<ol style="list-style-type: decimal">
<li>Deterministic (formula or constraint-based) simulation.</li>
<li>Special method simulation.</li>
<li>Restricted simulation.</li>
<li>Default simulation.</li>
</ol>
<p>The package tries to simulate the column with each method, with preserving the order of the above list.</p>
<p>That means, the package will try to simulate the column using special method first and when such method cannot be executed (the conditions for running such method are not met) then, the next method is applied. More to that when one of the methods successfully generated the data, the following ones are skipped.</p>
<p>The goal of this document is to describe each method providing required details and, if applied, provide an information how each method can be customized.</p>
<div id="deterministic-formula-or-constraint-based-simulation-" class="section level3">
<h3 class="hasAnchor">
<a href="#deterministic-formula-or-constraint-based-simulation-" class="anchor"></a>Deterministic (formula or constraint-based) simulation.</h3>
<p>Let’s imagine we want to generate tables that reflects standard database used in the library. One of the tables used there, can be the one describing all the books owned by the library.</p>
<p>The YAML configuration of such table can have a form:</p>
<pre><code># schema-books.yml
public:
  tables:
    books:
      columns:
        book_id:
          type: char(12)
        author:
          type: varchar
        title:
          type: varchar
        genre:
          type: varchar
        bought:
          type: date
        amount:
          type: smallint
        purchase_id:
          type: varchar</code></pre>
<p>While running the standard simulation process we get the following result:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>
<span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_source.html">schema_source</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"schema-books.yml"</span>, package <span class="op">=</span> <span class="st">"DataFakeR"</span><span class="op">)</span><span class="op">)</span>
<span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_simulate</a></span><span class="op">(</span><span class="va">sch</span><span class="op">)</span>
<span class="fu"><a href="../reference/schema_methods.html">schema_get_table</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"books"</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 10 x 7</span>
<span class="co">#&gt;    book_id  author   title    genre      bought     amount purchase_id</span>
<span class="co">#&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;      &lt;date&gt;      &lt;int&gt; &lt;chr&gt;      </span>
<span class="co">#&gt;  1 OoVtwCbu QJoEYa   XLaS     xljCUY     1971-02-17 -28970 ZUYlCSp    </span>
<span class="co">#&gt;  2 cXxXjdFu fRZxZuvf h        dkvg       1982-12-06  -6823 rMSssP     </span>
<span class="co">#&gt;  3 MCRxukhz VHwPDx   TSbmLV   WcDNUKrH   1999-06-19 -28513 H          </span>
<span class="co">#&gt;  4 ikcePHyu lHcxeV   NgJ      pci        2018-07-04 -17965 kFBzBRvgOm </span>
<span class="co">#&gt;  5 jpBYnLQM hQQLTzI  smigTbte IgQl       2012-03-14 -29188 rQZkhhyVGb </span>
<span class="co">#&gt;  6 HVVTHHMY E        rQk      Uyyl       1983-05-07  11159 L          </span>
<span class="co">#&gt;  7 NsCWpGdK Hjguim   NeZNdvuO NLeNbo     1996-09-13 -13255 ZTzULgHyaI </span>
<span class="co">#&gt;  8 GnuTiETO bi       Q        I          2016-05-26 -26167 g          </span>
<span class="co">#&gt;  9 qXqqpWng q        zgwYViH  VYtwtjxadR 1994-08-08 -28056 ziVQrHKuQS </span>
<span class="co">#&gt; 10 kAYLTfSF oy       dMyfaUt  SBat       2010-05-15  24932 oKAVZ</span></code></pre></div>
<p>Even though many columns don’t look realistic let’s take care of <code>book_id</code> and <code>purchase_id</code> columns. From the rules followed in the library, we know that:</p>
<ul>
<li>
<code>book_id</code> is the concatenation of first 4 letters from <code>author</code>, <code>title</code> and <code>bought</code>,</li>
<li>
<code>purchase_id</code> is concatenation of word ‘purchase_’ and column <code>bought</code> (such rule is checked by SQL <code>purchase_id = 'purchase_' || bought</code> check constraint).</li>
</ul>
<p>If we want to preserve such rules, we have two options:</p>
<ul>
<li>store the rules as <code>check_constraints</code> rewritten in R code,</li>
<li>define <code>book_id</code> and <code>purchase_id</code> using formula.</li>
</ul>
<p>Let’s describe <code>purchase_id</code> using the first method:</p>
<pre><code># schema-books_2.yml
public:
  tables:
    books:
      columns:
        book_id:
          type: char(12)
        author:
          type: varchar
        title:
          type: varchar
        genre:
          type: varchar
        bought:
          type: date
        amount:
          type: smallint
        purchase_id:
          type: varchar
      check_constraints:
        purchase_id_check:
          column: purchase_id
          expression: !expr purchase_id == paste0('purchase_', bought)</code></pre>
<p>let’s update the source and plot column dependencies:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_update_source</a></span><span class="op">(</span><span class="va">sch</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"schema-books_2.yml"</span>, package <span class="op">=</span> <span class="st">"DataFakeR"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/schema_methods.html">schema_plot_deps</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"books"</span><span class="op">)</span></code></pre></div>
<p><img src="simulation_methods_files/figure-html/unnamed-chunk-2-1.png" width="1600" style="display: block; margin: auto;"></p>
<p>As you can see DataFakeR detected dependency between <code>purchase_id</code> and <code>bought</code> column. More to that the package will assure <code>bought</code> column will be simulated before <code>purchase_id</code>.</p>
<p>Let’s take a quick look at the data:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_simulate</a></span><span class="op">(</span><span class="va">sch</span><span class="op">)</span>
<span class="fu"><a href="../reference/schema_methods.html">schema_get_table</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"books"</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 10 x 7</span>
<span class="co">#&gt;    book_id  author     title      genre     bought     amount</span>
<span class="co">#&gt;    &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;     &lt;date&gt;      &lt;int&gt;</span>
<span class="co">#&gt;  1 KZRpDRUS bVnNsuEksi JKxINeIhK  LkFH      2020-06-11 -13344</span>
<span class="co">#&gt;  2 jiJcVUeV noTSZCjx   bRdd       VhBHNl    1973-08-08 -24281</span>
<span class="co">#&gt;  3 CfOjSusR mICawvE    OMue       WF        2017-08-07  -8661</span>
<span class="co">#&gt;  4 wvBDkNJE UAyrAD     ZnCggoUL   T         2007-09-12  -1893</span>
<span class="co">#&gt;  5 ngSilEFa ZVrEkB     hXdmHbG    abvIVVXBv 1985-10-16 -31085</span>
<span class="co">#&gt;  6 xJdjADgp dRqmjgdN   eKbsdjZ    nyuzTSo   1979-04-13  -4147</span>
<span class="co">#&gt;  7 zZxHxYIU BZrXkZX    xHVdgQrw   HamKiXu   1985-06-29  26178</span>
<span class="co">#&gt;  8 qSzDjOOW RBhe       uPcdqBdNjK P         2011-09-08 -17948</span>
<span class="co">#&gt;  9 oDsgMvoo HShhTST    JuYWecgg   dBddwjd   1977-01-01 -29141</span>
<span class="co">#&gt; 10 MLuNjQjl vnHRMIyFD  HPnghwfmI  InPjGZE   2001-06-28 -12128</span>
<span class="co">#&gt;    purchase_id        </span>
<span class="co">#&gt;    &lt;chr&gt;              </span>
<span class="co">#&gt;  1 purchase_2020-06-11</span>
<span class="co">#&gt;  2 purchase_1973-08-08</span>
<span class="co">#&gt;  3 purchase_2017-08-07</span>
<span class="co">#&gt;  4 purchase_2007-09-12</span>
<span class="co">#&gt;  5 purchase_1985-10-16</span>
<span class="co">#&gt;  6 purchase_1979-04-13</span>
<span class="co">#&gt;  7 purchase_1985-06-29</span>
<span class="co">#&gt;  8 purchase_2011-09-08</span>
<span class="co">#&gt;  9 purchase_1977-01-01</span>
<span class="co">#&gt; 10 purchase_2001-06-28</span></code></pre></div>
<p>As we can see check constraint rule was applied to correctly create <code>purchase_id</code> column.</p>
<p><strong>Note:</strong> Check constraint expressions are used to detect column dependency and to create the checked column, only when the ones are equality expressions (that means the expression contains <code><a href="https://rdrr.io/r/base/Comparison.html">==</a></code> operator). Such expression assures the column definition is deterministic. In the future releases (depending on the user’s needs) the check expression rule can be extended to the cases where expression constains <code><a href="https://rdrr.io/r/base/Comparison.html">&lt;</a></code> and <code><a href="https://rdrr.io/r/base/Comparison.html">&gt;</a></code> operators.</p>
<p>Now let’s take care to assure that <code>book_id</code> is the first 8 letters of concatenation of <code>author</code>, <code>title</code> and <code>bought</code>-year. Such example can be also described using check constraint, but we’ll use a different method that opens various options for defining column rules.</p>
<p>If you want to create a column using custom expression, you pass it as a <code>formula</code> parameter in yaml configuration file. In our case, we want <code>book_id</code> be created with expression <code><a href="https://rdrr.io/r/base/paste.html">paste0(substr(author, 1, 4), substr(title, 1, 4), substr(bought, 1, 4))</a></code>. Let’s put it in configuration as <code>formula</code> parameter:</p>
<pre><code># schema-books_3.yml
public:
  tables:
    books:
      columns:
        book_id:
          type: char(12)
          formula: !expr paste0(substr(author, 1, 4), substr(title, 1, 4), substr(bought, 1, 4))
        author:
          type: varchar
        title:
          type: varchar
        genre:
          type: varchar
        bought:
          type: date
        amount:
          type: smallint
        purchase_id:
          type: varchar
      check_constraints:
        purchase_id_check:
          column: purchase_id
          expression: !expr purchase_id == paste0('purchase_', bought)</code></pre>
<p>Again, update the source and plot column dependencies:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_update_source</a></span><span class="op">(</span><span class="va">sch</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"schema-books_3.yml"</span>, package <span class="op">=</span> <span class="st">"DataFakeR"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/schema_methods.html">schema_plot_deps</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"books"</span><span class="op">)</span></code></pre></div>
<p><img src="simulation_methods_files/figure-html/unnamed-chunk-4-1.png" width="1600" style="display: block; margin: auto;"></p>
<p>The column dependencies are detected correctly. Let’s move then to simulation step:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_simulate</a></span><span class="op">(</span><span class="va">sch</span><span class="op">)</span>
<span class="fu"><a href="../reference/schema_methods.html">schema_get_table</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"books"</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 10 x 7</span>
<span class="co">#&gt;    book_id      author   title      genre      bought     amount</span>
<span class="co">#&gt;    &lt;chr&gt;        &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;      &lt;date&gt;      &lt;int&gt;</span>
<span class="co">#&gt;  1 MswCZY1986   MswCQq   ZY         y          1986-06-29  22762</span>
<span class="co">#&gt;  2 GTzWEhJM1979 GTzWPPdY EhJM       ayYLMBSyk  1979-12-19 -24661</span>
<span class="co">#&gt;  3 rdjCa2020    rdjCWK   a          jqEqKPHKcB 2020-07-28 -23651</span>
<span class="co">#&gt;  4 KjBXXHIP2001 KjBXmcV  XHIPl      UDvM       2001-07-10 -23590</span>
<span class="co">#&gt;  5 TUucM2000    TUucakYr M          yuqFZJt    2000-04-21  24526</span>
<span class="co">#&gt;  6 nTzOJfTy1977 nTzO     JfTyRcdMRE CLiN       1977-02-18  27014</span>
<span class="co">#&gt;  7 kctRFFfv2015 kctR     FFfvoY     AatWBL     2015-11-22    228</span>
<span class="co">#&gt;  8 KxtD2012     K        xtD        ohENWtGS   2012-07-19  31943</span>
<span class="co">#&gt;  9 qbt2001      qb       t          bSWYivOlPh 2001-01-06 -27890</span>
<span class="co">#&gt; 10 nQNqvwHC1976 nQNqxc   vwHCWAFa   H          1976-12-09  -1163</span>
<span class="co">#&gt;    purchase_id        </span>
<span class="co">#&gt;    &lt;chr&gt;              </span>
<span class="co">#&gt;  1 purchase_1986-06-29</span>
<span class="co">#&gt;  2 purchase_1979-12-19</span>
<span class="co">#&gt;  3 purchase_2020-07-28</span>
<span class="co">#&gt;  4 purchase_2001-07-10</span>
<span class="co">#&gt;  5 purchase_2000-04-21</span>
<span class="co">#&gt;  6 purchase_1977-02-18</span>
<span class="co">#&gt;  7 purchase_2015-11-22</span>
<span class="co">#&gt;  8 purchase_2012-07-19</span>
<span class="co">#&gt;  9 purchase_2001-01-06</span>
<span class="co">#&gt; 10 purchase_1976-12-09</span></code></pre></div>
<p>As we can see the result is again as expected.</p>
<p><strong>Note</strong> The formula expression is passed to <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">dplyr::mutate</a></code> in the implementation, which means you may use in the formula any dplyr-specific functions, such as <code>n()</code>.</p>
<p><strong>Note</strong> Formula-based column definition was classified as a ‘Deterministic simulation’ method, but you may also define formulas with random sampling inside. For example assuring that column <code>end_date</code> have values larger than <code>start_date</code> you may define: <code>formula: start_date + sample(1:10, dplyr::n(), replace = TRUE)</code>.</p>
</div>
<div id="special-method-simulation" class="section level3">
<h3 class="hasAnchor">
<a href="#special-method-simulation" class="anchor"></a>Special method simulation</h3>
<p>Let’s take a look at the last simulated data:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/schema_methods.html">schema_get_table</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"books"</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 10 x 7</span>
<span class="co">#&gt;    book_id      author   title      genre      bought     amount</span>
<span class="co">#&gt;    &lt;chr&gt;        &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;      &lt;date&gt;      &lt;int&gt;</span>
<span class="co">#&gt;  1 MswCZY1986   MswCQq   ZY         y          1986-06-29  22762</span>
<span class="co">#&gt;  2 GTzWEhJM1979 GTzWPPdY EhJM       ayYLMBSyk  1979-12-19 -24661</span>
<span class="co">#&gt;  3 rdjCa2020    rdjCWK   a          jqEqKPHKcB 2020-07-28 -23651</span>
<span class="co">#&gt;  4 KjBXXHIP2001 KjBXmcV  XHIPl      UDvM       2001-07-10 -23590</span>
<span class="co">#&gt;  5 TUucM2000    TUucakYr M          yuqFZJt    2000-04-21  24526</span>
<span class="co">#&gt;  6 nTzOJfTy1977 nTzO     JfTyRcdMRE CLiN       1977-02-18  27014</span>
<span class="co">#&gt;  7 kctRFFfv2015 kctR     FFfvoY     AatWBL     2015-11-22    228</span>
<span class="co">#&gt;  8 KxtD2012     K        xtD        ohENWtGS   2012-07-19  31943</span>
<span class="co">#&gt;  9 qbt2001      qb       t          bSWYivOlPh 2001-01-06 -27890</span>
<span class="co">#&gt; 10 nQNqvwHC1976 nQNqxc   vwHCWAFa   H          1976-12-09  -1163</span>
<span class="co">#&gt;    purchase_id        </span>
<span class="co">#&gt;    &lt;chr&gt;              </span>
<span class="co">#&gt;  1 purchase_1986-06-29</span>
<span class="co">#&gt;  2 purchase_1979-12-19</span>
<span class="co">#&gt;  3 purchase_2020-07-28</span>
<span class="co">#&gt;  4 purchase_2001-07-10</span>
<span class="co">#&gt;  5 purchase_2000-04-21</span>
<span class="co">#&gt;  6 purchase_1977-02-18</span>
<span class="co">#&gt;  7 purchase_2015-11-22</span>
<span class="co">#&gt;  8 purchase_2012-07-19</span>
<span class="co">#&gt;  9 purchase_2001-01-06</span>
<span class="co">#&gt; 10 purchase_1976-12-09</span></code></pre></div>
<p>As we mentioned in the previous section, we’re not happy with the result of multiple column values. In this section we’ll take of the result of <code>author</code> and <code>title</code> columns.</p>
<p>In case of <code>author</code> column, we’d like the values to be random, human readable names. Across R packages, there are many that offer such functionality. In case of DataFakeR, it’s just enough to define <code>spec: name</code> for the column definition:</p>
<pre><code># schema-books_4.yml
public:
  tables:
    books:
      columns:
        book_id:
          type: char(12)
          formula: !expr paste0(substr(author, 1, 4), substr(title, 1, 4), substr(bought, 1, 4))
        author:
          type: varchar
          spec: name
        title:
          type: varchar
        genre:
          type: varchar
        bought:
          type: date
        amount:
          type: smallint
        purchase_id:
          type: varchar
      check_constraints:
        purchase_id_check:
          column: purchase_id
          expression: !expr purchase_id == paste0('purchase_', bought)</code></pre>
<p>Again, update the source and plot column dependencies:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_update_source</a></span><span class="op">(</span><span class="va">sch</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"schema-books_4.yml"</span>, package <span class="op">=</span> <span class="st">"DataFakeR"</span><span class="op">)</span><span class="op">)</span>
<span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_simulate</a></span><span class="op">(</span><span class="va">sch</span><span class="op">)</span>
<span class="fu"><a href="../reference/schema_methods.html">schema_get_table</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"books"</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 10 x 7</span>
<span class="co">#&gt;    book_id      author            title      genre      bought     amount</span>
<span class="co">#&gt;    &lt;chr&gt;        &lt;chr&gt;             &lt;chr&gt;      &lt;chr&gt;      &lt;date&gt;      &lt;int&gt;</span>
<span class="co">#&gt;  1 TavaDHD1987  Tavaris Dicki     DHD        qa         1987-03-31  26032</span>
<span class="co">#&gt;  2 Hughbsga2014 Hugh Corkery      bsgaYOA    Fa         2014-12-04 -26637</span>
<span class="co">#&gt;  3 ParaMj1979   Paralee King      Mj         TVmrO      1979-11-03  -6062</span>
<span class="co">#&gt;  4 NakiAXfY1988 Nakita Kris       AXfYXEsbQs oafcJ      1988-02-22  24840</span>
<span class="co">#&gt;  5 ClaurIfI1989 Claudine Russel   rIfIoVBfr  xGLmoTO    1989-06-01   9224</span>
<span class="co">#&gt;  6 DejaXovv1996 Dejah Pagac MD    Xovv       yUiYW      1996-10-15  15407</span>
<span class="co">#&gt;  7 IoneKYqH2006 Ione Tromp PhD    KYqHNX     gvcQQhZofQ 2006-03-14  22101</span>
<span class="co">#&gt;  8 KaraRo1997   Karan King DDS    Ro         iwEgV      1997-02-16 -23947</span>
<span class="co">#&gt;  9 AnitTqbv1970 Anita Langworth   TqbvVYHxP  zyBO       1970-03-14 -30646</span>
<span class="co">#&gt; 10 Mrs.LVAc1992 Mrs. Mettie Berge LVAcejZn   XbPrRF     1992-07-05  28197</span>
<span class="co">#&gt;    purchase_id        </span>
<span class="co">#&gt;    &lt;chr&gt;              </span>
<span class="co">#&gt;  1 purchase_1987-03-31</span>
<span class="co">#&gt;  2 purchase_2014-12-04</span>
<span class="co">#&gt;  3 purchase_1979-11-03</span>
<span class="co">#&gt;  4 purchase_1988-02-22</span>
<span class="co">#&gt;  5 purchase_1989-06-01</span>
<span class="co">#&gt;  6 purchase_1996-10-15</span>
<span class="co">#&gt;  7 purchase_2006-03-14</span>
<span class="co">#&gt;  8 purchase_1997-02-16</span>
<span class="co">#&gt;  9 purchase_1970-03-14</span>
<span class="co">#&gt; 10 purchase_1992-07-05</span></code></pre></div>
<p>Voila!</p>
<p>How does it work?</p>
<p>Whenever you precise <code>spec</code> parameter to the column, DataFakeR will look for the simulation options if the special method with such name was defined. For the specific column type, such option is defined at <code>options$opt_simul_spec_&lt;column-type&gt;</code>.</p>
<p>So for the default options and character column type, we have:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">default_faker_opts</span><span class="op">$</span><span class="va">opt_simul_spec_character</span>
<span class="co">#&gt; $name</span>
<span class="co">#&gt; function (n, not_null, unique, default, spec_params, na_ratio, </span>
<span class="co">#&gt;     levels_ratio, ...) </span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;     call_args &lt;- names(sys.call())</span>
<span class="co">#&gt;     if (!"spec_params" %in% call_args) {</span>
<span class="co">#&gt;         spec_params &lt;- list()</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     spec_params$n &lt;- n</span>
<span class="co">#&gt;     unique_sample(do.call(charlatan::ch_name, spec_params), spec_params = spec_params, </span>
<span class="co">#&gt;         unique = unique) %&gt;% levels_rand(unique = unique, levels_ratio = levels_ratio) %&gt;% </span>
<span class="co">#&gt;         na_rand(not_null = not_null, na_ratio = na_ratio)</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; &lt;bytecode: 0x55812764e9f8&gt;</span>
<span class="co">#&gt; &lt;environment: namespace:DataFakeR&gt;</span></code></pre></div>
<p>The <code>name</code> method was defined and we were able to use it in the simulation. Looking at the function body, we may see it uses <code><a href="https://docs.ropensci.org/charlatan/reference/ch_name.html">charlatan::ch_name</a></code> function to simulate human-readable names.</p>
<p>What else can we spot regarding the method definition? The below points are worth notice:</p>
<ul>
<li>the method have <code>n</code> parameter. This is obligatory parameter for each simulation method.</li>
<li>the method parameters also contain standard column ones from YAML file. Whenever you need access to column parameters, just define them while creating the method. DataFakeR passes all the column parameters (not only the default ones) to each method.</li>
<li>if the parameter is not directly defined in the function it’s still possible to access all of them by parsing ellipsis (…). Please make sure ellipsis is always added as a function parameter.</li>
<li>by defining <code>spec_params</code> yaml configuration parameter you may access and parse them directly in the method definition. Such parameter allows to resolve conflicts with standard parameters names when duplication exist.</li>
</ul>
<p>Now, let’s take care of preparing human-readable title. For this case we’ll create our custom function. The titles will consist of combination of four words from predefined values:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">books</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">first</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Learning"</span>, <span class="st">"Amusing"</span>, <span class="st">"Hiding"</span>, <span class="st">"Symbols"</span>, <span class="st">"Hunting"</span>, <span class="st">"Smile"</span><span class="op">)</span>
  <span class="va">second</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Of"</span>, <span class="st">"On"</span>, <span class="st">"With"</span>, <span class="st">"From"</span>, <span class="st">"In"</span>, <span class="st">"Before"</span><span class="op">)</span>
  <span class="va">third</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"My"</span>, <span class="st">"Your"</span>, <span class="st">"The"</span>, <span class="st">"Common"</span>, <span class="st">"Mysterious"</span>, <span class="st">"A"</span><span class="op">)</span>
  <span class="va">fourth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Future"</span>, <span class="st">"South"</span>, <span class="st">"Technology"</span>, <span class="st">"Forest"</span>, <span class="st">"Storm"</span>, <span class="st">"Dreams"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">first</span>, <span class="va">n</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">second</span>, <span class="va">n</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">third</span>, <span class="va">n</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">fourth</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Let’s check a few possible results:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">books</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>
<span class="co">#&gt; [1] "Hiding In Common Technology" "Learning On The Future"     </span>
<span class="co">#&gt; [3] "Amusing From Your Storm"</span></code></pre></div>
<p>Perfect!</p>
<p>In order to present how <code>spec_params</code> can be used let’s add an option to skip the second word in the result:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">books</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">add_second</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">first</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Learning"</span>, <span class="st">"Amusing"</span>, <span class="st">"Hiding"</span>, <span class="st">"Symbols"</span>, <span class="st">"Hunting"</span>, <span class="st">"Smile"</span><span class="op">)</span>
  <span class="va">second</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Of"</span>, <span class="st">"On"</span>, <span class="st">"With"</span>, <span class="st">"From"</span>, <span class="st">"In"</span>, <span class="st">"Before"</span><span class="op">)</span>
  <span class="va">third</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"My"</span>, <span class="st">"Your"</span>, <span class="st">"The"</span>, <span class="st">"Common"</span>, <span class="st">"Mysterious"</span>, <span class="st">"A"</span><span class="op">)</span>
  <span class="va">fourth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Future"</span>, <span class="st">"South"</span>, <span class="st">"Technology"</span>, <span class="st">"Forest"</span>, <span class="st">"Storm"</span>, <span class="st">"Dreams"</span><span class="op">)</span>
  <span class="va">second_res</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">add_second</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">second_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">second</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">first</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="va">second_res</span>, 
    <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">third</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">fourth</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Now, let’s create the final method to use in the workflow.</p>
<p>The function needs to:</p>
<ul>
<li>take <code>n</code> parameter,</li>
<li>optional standard parameter <code>unique</code> (we’ll use it to assure unique results are returned),</li>
<li>
<code>spec_params</code> that allows us to modify special method parameters</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">simul_spec_character_book</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">unique</span>, <span class="va">spec_params</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">spec_params</span><span class="op">$</span><span class="va">n</span> <span class="op">&lt;-</span> <span class="va">n</span>
  
  <span class="fu">DataFakeR</span><span class="fu">::</span><span class="fu"><a href="../reference/sample_modifiers.html">unique_sample</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">books</span>, <span class="va">spec_params</span><span class="op">)</span>, 
    spec_params <span class="op">=</span> <span class="va">spec_params</span>, unique <span class="op">=</span> <span class="va">unique</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Before we run the example, let’s explain code blocks in function definition.</p>
<p>We’re evaluating <code>books</code> using <code>do.call</code>. That’s why we need to store all the parameters in the list passed to <code>do.call</code>. The only missing one is <code>n</code>, so:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spec_params</span><span class="op">$</span><span class="va">n</span> <span class="op">&lt;-</span> <span class="va">n</span></code></pre></div>
<p>We allowed our method to respect <code>unique</code> parameter, that’s why we want to assure the returned sample is unique. We may achieve this using <code><a href="../reference/sample_modifiers.html">DataFakeR::unique_sample</a></code>.</p>
<p>The function evaluates sampling expression multiple times, replacing duplicated values with the new ones. It’s worth to mention some of the function parameters:</p>
<ul>
<li>
<code>sim_expr</code> - simulation expression to be evaluated,</li>
<li>
<code>...</code> - parameters values used in <code>sim_expr</code>,</li>
<li>
<code>unique</code> - if TRUE, the function will try to generate unique values,</li>
<li>
<code>n_iter</code> - number of iteration to try generate unique value.</li>
</ul>
<p>So it’s enough to define:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">DataFakeR</span><span class="fu">::</span><span class="fu"><a href="../reference/sample_modifiers.html">unique_sample</a></span><span class="op">(</span>
  sim_expr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">books</span>, <span class="va">spec_params</span><span class="op">)</span>, 
  spec_params <span class="op">=</span> <span class="va">spec_params</span>, unique <span class="op">=</span> <span class="va">unique</span>
<span class="op">)</span></code></pre></div>
<p>Let’s modify configuration file with the <code>book</code> method (with using <code>spec_params</code> to simulate full title):</p>
<pre><code>schema-books_5.yml
public:
  tables:
    books:
      columns:
        book_id:
          type: char(8)
          formula: !expr paste0(substr(author, 1, 4), substr(title, 1, 4), substr(bought, 1, 4))
        author:
          type: varchar
          spec: name
        title:
          type: varchar
          spec: book
          spec_params:
            add_second: true
        genre:
          type: varchar
        bought:
          type: date
        amount:
          type: smallint
        purchase_id:
          type: varchar
      check_constraints:
        purchase_id_check:
          column: purchase_id
          expression: !expr purchase_id == paste0('purchase_', bought)</code></pre>
<p>and define the new method in the package options:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_opts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/faker_configuration.html">set_faker_opts</a></span><span class="op">(</span>
  opt_simul_spec_character <span class="op">=</span> <span class="fu"><a href="../reference/special_simulation.html">opt_simul_spec_character</a></span><span class="op">(</span>book <span class="op">=</span> <span class="va">simul_spec_character_book</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_source.html">schema_source</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"schema-books_5.yml"</span>, package <span class="op">=</span> <span class="st">"DataFakeR"</span><span class="op">)</span>, 
  faker_opts <span class="op">=</span> <span class="va">my_opts</span>
<span class="op">)</span>
<span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_simulate</a></span><span class="op">(</span><span class="va">sch</span><span class="op">)</span>
<span class="fu"><a href="../reference/schema_methods.html">schema_get_table</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"books"</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 10 x 7</span>
<span class="co">#&gt;    book_id      author                   title                         </span>
<span class="co">#&gt;    &lt;chr&gt;        &lt;chr&gt;                    &lt;chr&gt;                         </span>
<span class="co">#&gt;  1 ChriLear1984 Christy Block            Learning With Mysterious Storm</span>
<span class="co">#&gt;  2 CarrLear1998 Carrie McDermott         Learning From My South        </span>
<span class="co">#&gt;  3 DevoSymb2016 Devonte Hansen           Symbols From Mysterious Dreams</span>
<span class="co">#&gt;  4 AleaSmil2017 Alease Pouros            Smile On Common Storm         </span>
<span class="co">#&gt;  5 HarvHunt1976 Harvey Bogisich-Leuschke Hunting Before Your Technology</span>
<span class="co">#&gt;  6 VersAmus1977 Versie Rowe              Amusing From Common South     </span>
<span class="co">#&gt;  7 Ica Hunt1978 Ica Flatley              Hunting With A Dreams         </span>
<span class="co">#&gt;  8 BeniLear1990 Benito Franecki          Learning With My Future       </span>
<span class="co">#&gt;  9 Dr. Smil1982 Dr. Saverio Heller IV    Smile In Your Future          </span>
<span class="co">#&gt; 10 LeonLear2020 Leonel Ebert             Learning With The Future      </span>
<span class="co">#&gt;    genre      bought     amount purchase_id        </span>
<span class="co">#&gt;    &lt;chr&gt;      &lt;date&gt;      &lt;int&gt; &lt;chr&gt;              </span>
<span class="co">#&gt;  1 I          1984-09-28 -18916 purchase_1984-09-28</span>
<span class="co">#&gt;  2 fkYodnYtmP 1998-10-08   6322 purchase_1998-10-08</span>
<span class="co">#&gt;  3 dY         2016-05-23 -14514 purchase_2016-05-23</span>
<span class="co">#&gt;  4 wbRSqpcXz  2017-05-21  -5896 purchase_2017-05-21</span>
<span class="co">#&gt;  5 QaWcKSzAC  1976-03-21 -16899 purchase_1976-03-21</span>
<span class="co">#&gt;  6 BJXEbeMFm  1977-12-30  -3695 purchase_1977-12-30</span>
<span class="co">#&gt;  7 VvGxeAppvr 1978-11-30  20402 purchase_1978-11-30</span>
<span class="co">#&gt;  8 enFtPWKUfr 1990-03-12  20058 purchase_1990-03-12</span>
<span class="co">#&gt;  9 uM         1982-09-22  -1565 purchase_1982-09-22</span>
<span class="co">#&gt; 10 dqP        2020-01-29  30320 purchase_2020-01-29</span></code></pre></div>
<p>Great! We’ve managed to use our custom special method to simulate human-readable titles.</p>
<p>For the last part of this section it’s worth to mention the remaining special methods for each column type. For numeric, integer, logical and Date column classes, DataFakeR offer <code>spec: distr</code> method that allow to simulate column from the selected distribution. The method requires to provide:</p>
<pre><code>spec_params:
  method: &lt;method-name&gt;</code></pre>
<p>where method name is the name of simulation function such as <code>rnorm</code>, <code>rbinom</code> etc.</p>
<p>For example, in order to simulate the column from normal distribution with <code>mean = 10</code> and <code>sd = 5</code> we should define:</p>
<pre><code>spec: distr
spec_params:
  method: rnorm
  mean: 10
  sd: 5</code></pre>
</div>
<div id="restricted-simulation" class="section level3">
<h3 class="hasAnchor">
<a href="#restricted-simulation" class="anchor"></a>Restricted simulation</h3>
<p>Restricted simulation methods allow to simulate data considering exceptional parameters defined for each column.</p>
<p>Such parameters can be for example:</p>
<ul>
<li>
<code>values</code> - possible column values for the target column</li>
<li>
<code>range</code> - possible column values range for the target column</li>
</ul>
<p>All the restricted methods offered by DataFakeR for column type are defined in <code>default_faker_opts$opt_simul_restricted_&lt;column-type&gt;</code>.</p>
<p>Let’s take a look what methods are offered for integer columns:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">default_faker_opts</span><span class="op">$</span><span class="va">opt_simul_restricted_integer</span>
<span class="co">#&gt; $f_key</span>
<span class="co">#&gt; function (n, not_null, unique, default, type, values, na_ratio, </span>
<span class="co">#&gt;     levels_ratio, ...) </span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;     if (isTRUE(not_null)) {</span>
<span class="co">#&gt;         values &lt;- values[!is.na(values)]</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     if (isTRUE(unique)) {</span>
<span class="co">#&gt;         warning("Requested to simulate foreign key having unique values. Make sure config is correctly defined.")</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     sample(values, n, replace = !unique) %&gt;% na_rand(not_null = not_null, </span>
<span class="co">#&gt;         na_ratio = na_ratio)</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; &lt;bytecode: 0x5581276381d8&gt;</span>
<span class="co">#&gt; &lt;environment: namespace:DataFakeR&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $in_set</span>
<span class="co">#&gt; function (n, not_null, unique, default, type, values, na_ratio, </span>
<span class="co">#&gt;     levels_ratio, ...) </span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;     if (!missing(values)) {</span>
<span class="co">#&gt;         if (isTRUE(not_null)) {</span>
<span class="co">#&gt;             values &lt;- values[!is.na(values)]</span>
<span class="co">#&gt;         }</span>
<span class="co">#&gt;         return(sample(values, n, replace = !unique) %&gt;% na_rand(not_null = not_null, </span>
<span class="co">#&gt;             na_ratio = na_ratio))</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     return(NULL)</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; &lt;bytecode: 0x558127639198&gt;</span>
<span class="co">#&gt; &lt;environment: namespace:DataFakeR&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $range</span>
<span class="co">#&gt; function (n, not_null, unique, default, type, range, na_ratio, </span>
<span class="co">#&gt;     levels_ratio, ...) </span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;     if (!missing(range)) {</span>
<span class="co">#&gt;         return(unique_sample(round(stats::runif(n, range[1], </span>
<span class="co">#&gt;             range[2])), range = range, n = n, unique = unique) %&gt;% </span>
<span class="co">#&gt;             na_rand(not_null = not_null, na_ratio = na_ratio))</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     return(NULL)</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; &lt;bytecode: 0x558127635b58&gt;</span>
<span class="co">#&gt; &lt;environment: namespace:DataFakeR&gt;</span></code></pre></div>
<p>We can see there are three methods defined:</p>
<ul>
<li>
<code>f_key</code> - restricted method responsible for simulating foreign keys (we’ll come back to this one in the last part of the section),</li>
<li>
<code>range</code> - method taking <code>range</code> parameter. When <code>range</code> is missing <code>NULL</code> is returned, otherwise integers between <code>range[1]</code> and <code>range[2]</code> are returned,</li>
<li>
<code>in_set</code>- method taking <code>values</code> parameter. When <code>values</code> is missing <code>NULL</code> is returned, otherwise sampled values from <code>values</code> are returned.</li>
</ul>
<p>Let’s highlight the general rule for restricted methods used by the package (excluding <code>f_key</code> one):</p>
<ul>
<li>each method has <code>n</code> as obligatory parameter that determines number of returned values,</li>
<li>standard column parameters (<code>not_null</code>, <code>unique</code>, <code>type</code>) are optional but respected,</li>
<li>the method usually have defined ‘restriction’ parameter that determines whether the method should be applied or not,</li>
<li>when restriction condition is not met (for example ‘restriction’ parameter is missing) the method should return <code>NULL</code>.</li>
</ul>
<p>The last point allows DataFakeR to scan across all the restriction methods. When a method returns <code>NULL</code> result, the package moves to simulate from the next method defined in <code>opt_simul_restricted_&lt;column-type&gt;</code> setting.</p>
<p>Similar to special methods, you may also define a set of your custom restricted methods. You may achieve this by setting up new methods with:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="kw">set_faker_opts</span>(</span>
<span id="cb24-2"><a href="#cb24-2"></a>  opt_simul_restricted_<span class="op">&lt;</span>column<span class="op">-</span>type<span class="op">&gt;</span><span class="st"> </span><span class="er">=</span><span class="st"> </span>opt_simul_restricted_<span class="op">&lt;</span>column<span class="op">-</span>type<span class="op">&gt;</span>(<span class="dt">my_method =</span> method, ...)</span>
<span id="cb24-3"><a href="#cb24-3"></a>)</span></code></pre></div>
<p><strong>Note:</strong> DataFakeR allow also to rewrite currently existing method. So whenever you need to rewrite for example <code>in_set</code> method, just specify it as above.</p>
<p>Having the knowledge about restricted methods, let’s use them to generate <code>amount</code> column from values between <code>1</code> and <code>99</code>. We’ll do it by using range method for <code>amount</code> column:</p>
<pre><code># schema-books_6.yml
public:
  tables:
    books:
      columns:
        book_id:
          type: char(8)
          formula: !expr paste0(substr(author, 1, 4), substr(title, 1, 4), substr(bought, 1, 4))
        author:
          type: varchar
          spec: name
        title:
          type: varchar
          spec: book
          spec_params:
            add_second: true
        genre:
          type: varchar
        bought:
          type: date
        amount:
          type: smallint
          range: [1, 99]
        purchase_id:
          type: varchar
      check_constraints:
        purchase_id_check:
          column: purchase_id
          expression: !expr purchase_id == paste0('purchase_', bought)
</code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_update_source</a></span><span class="op">(</span><span class="va">sch</span>, <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"schema-books_6.yml"</span>, package <span class="op">=</span> <span class="st">"DataFakeR"</span><span class="op">)</span><span class="op">)</span>
<span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_simulate</a></span><span class="op">(</span><span class="va">sch</span><span class="op">)</span>
<span class="fu"><a href="../reference/schema_methods.html">schema_get_table</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"books"</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 10 x 7</span>
<span class="co">#&gt;    book_id      author             title                         genre     </span>
<span class="co">#&gt;    &lt;chr&gt;        &lt;chr&gt;              &lt;chr&gt;                         &lt;chr&gt;     </span>
<span class="co">#&gt;  1 MattLear2021 Matteo Wilderman   Learning With Common Storm    bTy       </span>
<span class="co">#&gt;  2 Dr. Symb1977 Dr. Reyna Effertz  Symbols Of The Storm          qsEyoRjRQT</span>
<span class="co">#&gt;  3 Ms. Lear1989 Ms. Reva Stehr DVM Learning On Mysterious Dreams gnTyui    </span>
<span class="co">#&gt;  4 Dr. Amus1980 Dr. Tabetha Ferry  Amusing From Common Dreams    nThgzToW  </span>
<span class="co">#&gt;  5 MeyeHunt1978 Meyer Stamm-Hintz  Hunting From Mysterious Storm VIacj     </span>
<span class="co">#&gt;  6 LottAmus2015 Lottie Smith       Amusing Before My South       RZII      </span>
<span class="co">#&gt;  7 VoneHunt2020 Vonetta Halvorson  Hunting Before Common Storm   apjhWhUYV </span>
<span class="co">#&gt;  8 WainHunt1971 Waino Barton       Hunting On Mysterious Storm   ErPnM     </span>
<span class="co">#&gt;  9 CanyAmus2018 Canyon Bogan       Amusing In A Dreams           ZuJnbzFes </span>
<span class="co">#&gt; 10 JadeAmus2004 Jaden Muller DDS   Amusing In My Technology      QhiwnsVjZQ</span>
<span class="co">#&gt;    bought     amount purchase_id        </span>
<span class="co">#&gt;    &lt;date&gt;      &lt;int&gt; &lt;chr&gt;              </span>
<span class="co">#&gt;  1 2021-01-23     24 purchase_2021-01-23</span>
<span class="co">#&gt;  2 1977-02-04     45 purchase_1977-02-04</span>
<span class="co">#&gt;  3 1989-11-10     27 purchase_1989-11-10</span>
<span class="co">#&gt;  4 1980-08-13     12 purchase_1980-08-13</span>
<span class="co">#&gt;  5 1978-03-04      8 purchase_1978-03-04</span>
<span class="co">#&gt;  6 2015-06-21     42 purchase_2015-06-21</span>
<span class="co">#&gt;  7 2020-03-13     30 purchase_2020-03-13</span>
<span class="co">#&gt;  8 1971-12-30     87 purchase_1971-12-30</span>
<span class="co">#&gt;  9 2018-08-07     27 purchase_2018-08-07</span>
<span class="co">#&gt; 10 2004-04-06     57 purchase_2004-04-06</span></code></pre></div>
<p>Awesome! Let’s simulate now human-readable book genre from a set of defined values. We can achieve this using <code>in_set</code> method for character column type:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">default_faker_opts</span><span class="op">$</span><span class="va">opt_simul_restricted_character</span><span class="op">$</span><span class="va">in_set</span>
<span class="co">#&gt; function (n, not_null, unique, default, nchar, type, values, </span>
<span class="co">#&gt;     na_ratio, levels_ratio, ...) </span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;     if (!missing(values)) {</span>
<span class="co">#&gt;         if (isTRUE(not_null)) {</span>
<span class="co">#&gt;             values &lt;- values[!is.na(values)]</span>
<span class="co">#&gt;         }</span>
<span class="co">#&gt;         return(sample(values, n, replace = !unique) %&gt;% na_rand(not_null = not_null, </span>
<span class="co">#&gt;             na_ratio = na_ratio))</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     return(NULL)</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; &lt;bytecode: 0x55812764d2b8&gt;</span>
<span class="co">#&gt; &lt;environment: namespace:DataFakeR&gt;</span></code></pre></div>
<p>So let’s assume we want the genre to be simulated from set: <code>Fantasy</code>, <code>Adventure</code>, <code>Horror</code>, <code>Romance</code>.</p>
<p>Let’s define such set as possible <code>values</code> for <code>genre</code> column:</p>
<pre><code>schema-books_7.yml
public:
  tables:
    books:
      columns:
        book_id:
          type: char(8)
          formula: !expr paste0(substr(author, 1, 4), substr(title, 1, 4), substr(bought, 1, 4))
        author:
          type: varchar
          spec: name
        title:
          type: varchar
          spec: book
          spec_params:
            add_second: true
        genre:
          type: varchar
          values: [Fantasy, Adventure, Horror, Romance]
        bought:
          type: date
        amount:
          type: smallint
          range: [1, 99]
        purchase_id:
          type: varchar
      check_constraints:
        purchase_id_check:
          column: purchase_id
          expression: !expr purchase_id == paste0('purchase_', bought)
</code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_update_source</a></span><span class="op">(</span><span class="va">sch</span>, <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"schema-books_7.yml"</span>, package <span class="op">=</span> <span class="st">"DataFakeR"</span><span class="op">)</span><span class="op">)</span>
<span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_simulate</a></span><span class="op">(</span><span class="va">sch</span><span class="op">)</span>
<span class="fu"><a href="../reference/schema_methods.html">schema_get_table</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"books"</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 10 x 7</span>
<span class="co">#&gt;    book_id      author                title                               </span>
<span class="co">#&gt;    &lt;chr&gt;        &lt;chr&gt;                 &lt;chr&gt;                               </span>
<span class="co">#&gt;  1 GeorHunt1999 George O'Conner       Hunting Before Mysterious Technology</span>
<span class="co">#&gt;  2 DevoHidi2020 Devonte McClure       Hiding Of The Forest                </span>
<span class="co">#&gt;  3 ConaSmil1994 Conard Volkman-Walker Smile Of The Dreams                 </span>
<span class="co">#&gt;  4 EloyHidi1975 Eloy Ratke III        Hiding Before Common Future         </span>
<span class="co">#&gt;  5 PhoeSmil2019 Phoebe Swaniawski     Smile Of My Forest                  </span>
<span class="co">#&gt;  6 AdelSmil1982 Adeline Block PhD     Smile From Common South             </span>
<span class="co">#&gt;  7 Dr. Hunt1975 Dr. Albin Reinger     Hunting From A Forest               </span>
<span class="co">#&gt;  8 MoirSymb1997 Moira Lebsack         Symbols From A Future               </span>
<span class="co">#&gt;  9 KeilSmil2002 Keila Gleichner PhD   Smile With A Dreams                 </span>
<span class="co">#&gt; 10 AlexLear1998 Alexus Bogisich       Learning In Common South            </span>
<span class="co">#&gt;    genre     bought     amount purchase_id        </span>
<span class="co">#&gt;    &lt;chr&gt;     &lt;date&gt;      &lt;int&gt; &lt;chr&gt;              </span>
<span class="co">#&gt;  1 Adventure 1999-12-14     24 purchase_1999-12-14</span>
<span class="co">#&gt;  2 Fantasy   2020-02-18     46 purchase_2020-02-18</span>
<span class="co">#&gt;  3 Horror    1994-06-04     57 purchase_1994-06-04</span>
<span class="co">#&gt;  4 Adventure 1975-06-09     40 purchase_1975-06-09</span>
<span class="co">#&gt;  5 Romance   2019-06-17     10 purchase_2019-06-17</span>
<span class="co">#&gt;  6 Romance   1982-02-11     23 purchase_1982-02-11</span>
<span class="co">#&gt;  7 Fantasy   1975-05-07     73 purchase_1975-05-07</span>
<span class="co">#&gt;  8 Horror    1997-02-05     29 purchase_1997-02-05</span>
<span class="co">#&gt;  9 Romance   2002-10-27     83 purchase_2002-10-27</span>
<span class="co">#&gt; 10 Adventure 1998-06-21     43 purchase_1998-06-21</span></code></pre></div>
<p>Let’s add the last improvement by specifying date range for books:</p>
<pre><code>schema-books_8.yml
public:
  tables:
    books:
      columns:
        book_id:
          type: char(8)
          formula: !expr paste0(substr(author, 1, 4), substr(title, 1, 4), substr(bought, 1, 4))
        author:
          type: varchar
          spec: name
        title:
          type: varchar
          spec: book
          spec_params:
            add_second: true
        genre:
          type: varchar
          values: [Fantasy, Adventure, Horror, Romance]
        bought:
          type: date
          range: ['2020-01-02', '2021-06-01']
        amount:
          type: smallint
          range: [1, 99]
        purchase_id:
          type: varchar
      check_constraints:
        purchase_id_check:
          column: purchase_id
          expression: !expr purchase_id == paste0('purchase_', bought)
</code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_update_source</a></span><span class="op">(</span><span class="va">sch</span>, <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"schema-books_8.yml"</span>, package <span class="op">=</span> <span class="st">"DataFakeR"</span><span class="op">)</span><span class="op">)</span>
<span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_simulate</a></span><span class="op">(</span><span class="va">sch</span><span class="op">)</span>
<span class="fu"><a href="../reference/schema_methods.html">schema_get_table</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"books"</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 10 x 7</span>
<span class="co">#&gt;    book_id      author                  title                       genre    </span>
<span class="co">#&gt;    &lt;chr&gt;        &lt;chr&gt;                   &lt;chr&gt;                       &lt;chr&gt;    </span>
<span class="co">#&gt;  1 ChriLear2020 Christoper Kerluke      Learning Before A South     Horror   </span>
<span class="co">#&gt;  2 LeeaAmus2020 Leeann Rice             Amusing Of Mysterious Storm Horror   </span>
<span class="co">#&gt;  3 Mrs.Smil2020 Mrs. Alys Dickinson DVM Smile With Mysterious South Romance  </span>
<span class="co">#&gt;  4 ChriSymb2020 Christin Padberg DVM    Symbols On Your Dreams      Fantasy  </span>
<span class="co">#&gt;  5 DeboHidi2020 Debora Schamberger      Hiding Before Your South    Romance  </span>
<span class="co">#&gt;  6 EzzaAmus2020 Ezzard Keeling          Amusing With Common Forest  Fantasy  </span>
<span class="co">#&gt;  7 KaylHunt2020 Kaylen Brown PhD        Hunting In A Storm          Romance  </span>
<span class="co">#&gt;  8 Mr. Lear2020 Mr. Jovanni Lemke Sr.   Learning In My Dreams       Horror   </span>
<span class="co">#&gt;  9 DuncSymb2020 Duncan Sanford-Schmeler Symbols From A Future       Adventure</span>
<span class="co">#&gt; 10 TracHidi2020 Tracie Roob             Hiding On A Forest          Horror   </span>
<span class="co">#&gt;    bought     amount purchase_id        </span>
<span class="co">#&gt;    &lt;date&gt;      &lt;int&gt; &lt;chr&gt;              </span>
<span class="co">#&gt;  1 2020-09-15      9 purchase_2020-09-15</span>
<span class="co">#&gt;  2 2020-12-03     86 purchase_2020-12-03</span>
<span class="co">#&gt;  3 2020-01-31     18 purchase_2020-01-31</span>
<span class="co">#&gt;  4 2020-12-13     96 purchase_2020-12-13</span>
<span class="co">#&gt;  5 2020-05-22     18 purchase_2020-05-22</span>
<span class="co">#&gt;  6 2020-09-14      4 purchase_2020-09-14</span>
<span class="co">#&gt;  7 2020-01-12     19 purchase_2020-01-12</span>
<span class="co">#&gt;  8 2020-12-01     10 purchase_2020-12-01</span>
<span class="co">#&gt;  9 2020-07-21     96 purchase_2020-07-21</span>
<span class="co">#&gt; 10 2020-08-24     87 purchase_2020-08-24</span></code></pre></div>
<p>Here we are.</p>
<p>For the last part of restricted methods, let’s add a few words about <code>f_key</code> restricted method.</p>
<p>As mentioned the method is responsible for simulating foreign key columns. When the column is defined in schema as a foreign key, DataFakeR will source possible values from the parent table and pass such values set as a <code>values</code> parameter to <code>f_key</code> method.</p>
<p>Simulating foreign key will skip execution of the remaining restricted methods defined in options.</p>
<p>To see it in action, let’s extend our schema definition by adding a new <code>borrowed</code> table (let’s also precise <code>nrows</code> for each table).</p>
<pre><code># schema-books_9.yml
public:
  tables:
    books:
      nrows: 10
      columns:
        book_id:
          type: char(8)
          formula: !expr paste0(substr(author, 1, 4), substr(title, 1, 4), substr(bought, 1, 4))
        author:
          type: varchar
          spec: name
        title:
          type: varchar
          spec: book
          spec_params:
            add_second: true
        genre:
          type: varchar
          values: [Fantasy, Adventure, Horror, Romance]
        bought:
          type: date
          range: ['2020-01-02', '2021-06-01']
        amount:
          type: smallint
          range: [1, 99]
        purchase_id:
          type: varchar
      check_constraints:
        purchase_id_check:
          column: purchase_id
          expression: !expr purchase_id == paste0('purchase_', bought)
    borrowed:
      nrows: 30
      columns:
        book_id:
          type: char(8)
        user_id:
          type: char(10)
      foreign_keys:
        book_id_fkey:
          columns: book_id
          references:
            columns: book_id
            table: books</code></pre>
<p>Let’s update the file and check table dependencies:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_update_source</a></span><span class="op">(</span><span class="va">sch</span>, <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"schema-books_9.yml"</span>, package <span class="op">=</span> <span class="st">"DataFakeR"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/schema_methods.html">schema_plot_deps</a></span><span class="op">(</span><span class="va">sch</span><span class="op">)</span></code></pre></div>
<p><img src="simulation_methods_files/figure-html/unnamed-chunk-22-1.png" width="1600" style="display: block; margin: auto;"></p>
<p>As shown, DataFakeR detected dependency between <code>books</code> and <code>borrowed</code>, and will generate <code>books</code> table first to get possible values for foreign key column.</p>
<p>Let’s simulate the data and compare simumlated book ids:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_simulate</a></span><span class="op">(</span><span class="va">sch</span><span class="op">)</span>
<span class="fu"><a href="../reference/schema_methods.html">schema_get_table</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"books"</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 10 x 7</span>
<span class="co">#&gt;    book_id      author                 title                          genre    </span>
<span class="co">#&gt;    &lt;chr&gt;        &lt;chr&gt;                  &lt;chr&gt;                          &lt;chr&gt;    </span>
<span class="co">#&gt;  1 TawnHidi2020 Tawny Schulist DVM     Hiding From The Future         Horror   </span>
<span class="co">#&gt;  2 Ms. Amus2021 Ms. Christine Schuster Amusing Of Common Dreams       Adventure</span>
<span class="co">#&gt;  3 MariHunt2020 Maritza Mosciski       Hunting With My Future         Adventure</span>
<span class="co">#&gt;  4 Mr. Smil2021 Mr. Clinton Herzog DVM Smile On Your Storm            Adventure</span>
<span class="co">#&gt;  5 HoseSymb2021 Hosea Adams            Symbols Before Common Forest   Horror   </span>
<span class="co">#&gt;  6 Dr. Symb2020 Dr. Eino Hansen MD     Symbols With Mysterious Future Fantasy  </span>
<span class="co">#&gt;  7 SybiLear2020 Sybilla Hilpert        Learning In Mysterious Storm   Horror   </span>
<span class="co">#&gt;  8 HilmHidi2020 Hilma Hermiston        Hiding Of The South            Adventure</span>
<span class="co">#&gt;  9 RollHunt2021 Rolland Waelchi        Hunting From The Forest        Fantasy  </span>
<span class="co">#&gt; 10 LeigSmil2020 Leighton O'Conner      Smile In Common Storm          Fantasy  </span>
<span class="co">#&gt;    bought     amount purchase_id        </span>
<span class="co">#&gt;    &lt;date&gt;      &lt;int&gt; &lt;chr&gt;              </span>
<span class="co">#&gt;  1 2020-08-23     89 purchase_2020-08-23</span>
<span class="co">#&gt;  2 2021-02-27     63 purchase_2021-02-27</span>
<span class="co">#&gt;  3 2020-06-08     31 purchase_2020-06-08</span>
<span class="co">#&gt;  4 2021-01-16     21 purchase_2021-01-16</span>
<span class="co">#&gt;  5 2021-04-04     26 purchase_2021-04-04</span>
<span class="co">#&gt;  6 2020-10-25     62 purchase_2020-10-25</span>
<span class="co">#&gt;  7 2020-07-27     40 purchase_2020-07-27</span>
<span class="co">#&gt;  8 2020-06-19     86 purchase_2020-06-19</span>
<span class="co">#&gt;  9 2021-01-03      2 purchase_2021-01-03</span>
<span class="co">#&gt; 10 2020-11-14     82 purchase_2020-11-14</span></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="../reference/schema_methods.html">schema_get_table</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"borrowed"</span><span class="op">)</span><span class="op">$</span><span class="va">book_id</span><span class="op">)</span>
<span class="co">#&gt;  [1] "MariHunt2020" "LeigSmil2020" "HilmHidi2020" "Mr. Smil2021" "RollHunt2021"</span>
<span class="co">#&gt;  [6] NA             "TawnHidi2020" "HoseSymb2021" "Ms. Amus2021" "SybiLear2020"</span></code></pre></div>
<p>So the values were correctly inherited from parent table.</p>
</div>
<div id="default-simulation" class="section level2">
<h2 class="hasAnchor">
<a href="#default-simulation" class="anchor"></a>Default simulation</h2>
<p>When none of the above methods were applied DataFakeR will simulate the column using the default method. For each column type you may find the default methods defined at <code>default_faker_opts$default_faker_opts$opt_simul_default_fun_&lt;column-type&gt;</code>.</p>
<p>In order to overwrite such method it’s just enough to:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="kw">set_faker_opts</span>(</span>
<span id="cb36-2"><a href="#cb36-2"></a>  opt_simul_default_fun_<span class="op">&lt;</span>column<span class="op">-</span>type<span class="op">&gt;</span><span class="st"> </span><span class="er">=</span><span class="st"> </span>my_custom_method</span>
<span id="cb36-3"><a href="#cb36-3"></a>)</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Krystian Igras.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
